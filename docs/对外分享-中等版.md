### Later — 团队分享版（中等篇幅）

## 1) 为什么需要 Later（痛点与场景）
在信息过载的当下，我们经常在视频号、文章、社群里刷到有意思的 AI 工具，但当时没有空深入了解：要么得先去读官网、搜教程、比价格，要么再让 AI 跑一轮调研。现实是，我们往往只是“先截个图/存个链接”，之后就躺在收藏夹里吃灰。  
Later 的目标是弥合“灵感抓取”与“系统了解”之间的断层：把截图/链接/文字丢给 Later，系统会自动汇总更完整的信息，产出带引用、可迭代更新的“动态一页纸”；等你有空时，直接阅读精华、看引用、继续追问即可。

一句话：把“随手收藏”变成“随时可用的结构化知识”。

- 结构化一页纸：概述、特性、如何使用、定价、竞品、集成、用户反馈、近期更新、技术栈、来源等  
- 带引用的 RAG 问答：回答附带文档片段与来源链接  
- Watchlist 持续更新：关注的工具会定期刷新并记录变更  
- 多入口输入：Web 与 Telegram 皆可发起（链接/截图/文字）


## 2) 架构总览（Orchestration & 流程）
核心流程（LangGraph 节点）：
- resolve_tool：规范化 URL、去重与官方站点识别；识别“文章链接”并与工具实体关联  
- ingest：抓取网页/图片 OCR、分块、嵌入、入库（含来源与时间）  
- augment_sources：拓展来源（Docs/Blog/Pricing/News + 社交/视频平台）并评分限流  
- research：合成结构化 one_pager（事实优先、可溯源）  
- juror（轻量核验）：基于搜索结果快速验证若干关键事实（控制在 2 分钟内）  
- dbwrite：写入工具与版本，快照来源，记录审计与媒体

运行策略：
- 新鲜度：默认 6 小时内存在最新版本且非 force 则跳过重处理，直接复用  
- 版本化：重要更新产出新版本；支持按用户链接其当前版本的视图/媒体  
- RAG 检索：混合结构化事实（one_pager）与文档片段，提升回答可读性与可证据性


## 3) 技术栈与关键依赖
- 模型与搜索
  - OpenAI：GPT‑4o（主推理/视觉/聊天）、GPT‑4o‑mini（路由/抽取/轻量验证）
  - 向量：text‑embedding‑3‑large（3072 维；可按需降维 1536）
  - 搜索/抓取：Tavily API + Firecrawl/Playwright（JS 页面）+ OCR（GPT‑4o 或 OCR 引擎）
- 后端
  - FastAPI（Python）、Uvicorn、Pydantic v2、AsyncPG、httpx、BeautifulSoup
  - LangGraph（编排）、LangSmith（全链路追踪）
  - 任务队列（规划/规范中）：ARQ + Redis（持久化、去重、重试）
- 数据库
  - Supabase（PostgreSQL）+ pgvector；IVFFLAT 索引（数据量达标后建立）
- 前端
  - React 19、React Router 7、Vite 7、TailwindCSS 3、i18next、lucide‑react、@supabase/supabase‑js、Stripe（预留）


## 4) 数据模型（DB 概览）
围绕“高质量检索 + 溯源 + 版本化”扩展的模式：
- tools：工具主表（name、canonical_url 唯一去重、one_pager JSONB、embedding、status、watchlist 等）
- documents：RAG 源文档分块（tool_id、source_url、chunk_text、chunk_embedding、last_crawled 等；(tool_id, source_url, chunk_index) 唯一）
- tool_updates：事实更新审计（field_changed、new_value、citation_source、source_agent、timestamp）
- tool_versions：按工具版本化的 one_pager（version_no、is_latest、diff_from_prev、last_checked_at）
- tool_version_documents：版本与文档快照关联（version 由哪些文档“告知”）
- user_tool_versions：用户与工具版本的关联（支持“我的当前视图”）
- media_items：版本绑定的 Highlights（平台、链接、作者/账号、指标、发布时间、缩略图）
- conversations：Harvester 的输入语料（用户维度对话，供挖掘更新信号）
- jobs：持久化任务（类型、负载、状态、去重键、尝试次数、错误信息、时间戳）
- user_watchlist：用户关注列表（支持“按关注批量刷新与版本链接”）

说明：以上以仓库内迁移脚本为准（`db/migrations/*.sql`）。


## 5) 后端能力（API 概览）
- 采集
  - `POST /v1/ingest`：入参 `url` 或 `name`（可选 `force`）；返回 `tool_id` 与状态  
  - `POST /v1/ingest/image`：上传截图，OCR 后识别产品名并发起采集  
  - `GET /v1/ingest/stream`：SSE 流式进度（resolve → ingest → augment_sources → research → juror → dbwrite）
- RAG 聊天
  - `POST /v1/chat`：支持 `scope=tool|global`，`prefer_one_pager` 与 `rag_limit`；返回带引用的回答
- 工具与版本
  - `GET /v1/tools`：工具列表（含关注/更新计数/简要概述与 last_updated）  
  - `GET /v1/tools/{id}`：详情（one_pager + sources + media_items；若有用户上下文，优先用户关联版本）  
  - `DELETE /v1/tools/{id}/versions/latest`：删除最新版本并自动提升上一个版本为最新；或在提供 `user_id` 时仅为该用户解绑
- Watchlist & Telegram 绑定
  - `POST /v1/tools/{id}/watchlist`：用户维度关注/取消  
  - `POST /v1/auth/link/telegram/start`：生成短期令牌用于绑定 Telegram  
  - `GET /v1/auth/link/telegram/status`：查询当前用户是否已绑定


## 6) 前端信息架构（简述）
- 首页（Dashboard）：
  - DropZone（粘贴链接/拖入截图/输入名称）→ 触发采集  
  - Knowledge Gallery（卡片栅格，含 Watchlist 星标/更新徽标/快速摘要/“开始聊天”）  
  - Detail View：左侧渲染 one_pager 富字段；右侧是带引用的聊天（支持 tool/global 范围）
- 设计原则：Digital Zen（简洁、克制、开发者友好、Dark Mode 优先）；桌面 Grid 优先、移动端语音优先


## 7) 使用路径（Web & Telegram）
- Web：在 DropZone 粘贴链接/拖入截图/输入产品名 → 生成卡片 → 打开 Detail → 直接阅读并提问（带引用回答） → 加入 Watchlist 等待后续更新  
- Telegram：向 Bot 发送链接/截图/文字 → Bot 抓取与合成 → 返回摘要或详情链接 → 需要深读时在 Web 端查看并继续问答


## 8) 运行与快速开始（本地）
- 环境：在 `backend/.env` 中设置 OPENAI_API_KEY、DATABASE_URL（Supabase/Postgres）、TAVILY_API_KEY、ALLOWED_ORIGINS、ENVIRONMENT  
- 数据库迁移：`psql $DATABASE_URL -f db/migrations/0001_mvp.sql`（并按需运行 0003/0006 等表）  
- 启动后端：`cd backend && python -m venv .venv && source .venv/bin/activate && pip install -r requirements.txt && uvicorn app.main:app --reload --port 8000`  
- 前端：`cd web && npm i && npm run dev`（确保前端指向 `http://127.0.0.1:8000`）


## 9) 质量与守护（简要）
- 可观测：LangSmith 全链路追踪；记录节点输入/输出、token 与延迟  
- 可靠性：外部 API 抖动采用指数退避重试；抓取遵从 robots.txt；缓存 ETag/Last‑Modified；JS 站点回退 Playwright  
- 安全：CORS、Telegram Webhook 签名校验、基本速率限制  
- 新鲜度：默认 6h 窗口内复用最新版本，可 `force` 强制重跑


## 10) 未来演进（提要）
- 更强的混合检索：MMR/去冗与 one_pager 融合策略持续迭代  
- 一页纸富字段与媒体 Highlights 提升：跨平台质量阈值与影响力判定  
- 编排节点稳健化：异常与重试策略细化、持久化任务链完善  
- Watchlist 全链路：关注→刷新→版本链接→更新提示闭环优化

——  
如需对外演示素材（截图/短视频），可参考简版文档 `docs/对外分享-简版介绍.md` 中的占位说明进行补充。


